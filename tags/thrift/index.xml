<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Thrift on babifarm.com</title>
    <link>http://babifarm.com/tags/thrift/</link>
    <description>Recent content in Thrift on babifarm.com</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 02 Aug 2016 09:06:46 -0700</lastBuildDate>
    <atom:link href="http://babifarm.com/tags/thrift/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Protobuf vs Thrift 性能测试</title>
      <link>http://babifarm.com/post/2016/08/protobuf-vs-thrift/</link>
      <pubDate>Tue, 02 Aug 2016 09:06:46 -0700</pubDate>
      
      <guid>http://babifarm.com/post/2016/08/protobuf-vs-thrift/</guid>
      <description>简单对象结构的对比 protobuf 文件 package com.many.pro; message User { required string id = 1; required int32 weight = 2; required int32 age = 3; required string name = 4; required string title = 5; required string desc = 6; } thrift 文件 namespace java com.many.thrift struct User{ 1: required string id ; 2: required i32 weight ; 3: required i32 age ; 4: required string name ; 5: required string title ; 6: required string desc ; } 测试前提： 测试对象：测试时都会设置相同的属性值，保证测试公平 测试结果： 1、固定1分钟测试结果 名称 动作 大小 次数 protobuf 序列化 965 byte 12,560,420 thrift 序列化 994 byte 8,487,338 protobuf 反序列化 965 byte 88,119,395 thrift 反序列化 994 byte 10,147,918 protobuf 序列化反序列化交替进行 965 byte 10,713,643*2 thrift 序列化反序列化交替进行 994 byte 4,495,906*2 2、固定次数（1000000次）测试结果： 名称 动作 大小 时间(ms) protobuf 序列化 965 byte 4782 thrift 序列化 994 byte 6965 protobuf 反序列化 965 byte 624 thrift 反序列化 994 byte 5662 测试代码 1、protobuf 固定100000此测试代码（简单对象） package com.many.pro.thriftvsproto; import com.google.protobuf.InvalidProtocolBufferException; import com.many.pro.UserModel; public class ProtoSimpleTest { private byte [] bytes; public void serialization(){ long start = System.currentTimeMillis(); for(int i=0;i&amp;lt;1000000;i++){ UserModel.User.Builder builder = UserModel.User.newBuilder(); builder.setId(&amp;quot;123&amp;quot;); builder.setAge(123); builder.setDesc(&amp;quot;ni hao i am test&amp;quot;); builder.setName(&amp;quot;test&amp;quot;); builder.setTitle(&amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot;); builder.setWeight(200); UserModel.User user = builder.build(); user.toByteArray(); } long lastTime = System.currentTimeMillis() - start; initBytes(); int size = bytes.length; System.out.println(&amp;quot;protobuffer 序列化循环100w times，单条大小：&amp;quot;+size+&amp;quot; byte&amp;quot;+&amp;quot; 耗时：&amp;quot;+lastTime+&amp;quot; ms&amp;quot;); } public void un_serialization(){ initBytes(); long start = System.currentTimeMillis(); try { for(int i=0;i&amp;lt;1000000;i++){ UserModel.User user = UserModel.User.parseFrom(bytes); } } catch (InvalidProtocolBufferException e) { e.printStackTrace(); } int size = bytes.length; long lastTime = System.currentTimeMillis() - start; System.out.println(&amp;quot;protobuffer 反序列化循环100w times，单条大小：&amp;quot;+size+&amp;quot; byte&amp;quot;+&amp;quot; 耗时：&amp;quot;+lastTime+&amp;quot; ms&amp;quot;); } public void initBytes(){ UserModel.User.Builder builder = UserModel.User.newBuilder(); builder.setId(&amp;quot;123&amp;quot;); builder.setAge(123); builder.setDesc(&amp;quot;ni hao i am test&amp;quot;); builder.setName(&amp;quot;test&amp;quot;); builder.setTitle(&amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot;); builder.setWeight(200); UserModel.User user = builder.build(); bytes = user.toByteArray(); } public static void main(String [] args){ ProtoSimpleTest test = new ProtoSimpleTest(); test.serialization(); test.un_serialization(); } } 2、thrift 固定100000此测试代码（简单对象） package com.many.pro.thriftvsproto; import org.apache.thrift.TException; import org.apache.thrift.protocol.TBinaryProtocol; import org.apache.thrift.transport.TIOStreamTransport; import org.apache.thrift.transport.TTransport; import com.many.thrift.User; import java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; public class ThriftSimlpleTest { private byte [] bytes; public void serialization() throws TException { long start = System.currentTimeMillis(); for(int i=0;i&amp;lt;1000000;i++){ User user = new User(); user.setId(&amp;quot;123&amp;quot;); user.setAge(123); user.setDesc(&amp;quot;ni hao i am test&amp;quot;); user.setName(&amp;quot;test&amp;quot;); user.setTitle(&amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot;); user.setWeight(200); // 序列化 ByteArrayOutputStream out = new ByteArrayOutputStream(); TTransport trans = new TIOStreamTransport(out); TBinaryProtocol tp = new TBinaryProtocol(trans); user.write(tp); //out.toByteArray(); } long lastTime = System.currentTimeMillis() - start; initBytes(); int size = bytes.length; System.out.println(&amp;quot;Thrift 序列化循环100w times，单条大小：&amp;quot;+size+&amp;quot; byte&amp;quot;+&amp;quot; 耗时：&amp;quot;+lastTime+&amp;quot; ms&amp;quot;); } public void un_serialization() throws TException { initBytes(); long start = System.currentTimeMillis(); for(int i=0;i&amp;lt;1000000;i++){ // 反序列化 ByteArrayInputStream in = new ByteArrayInputStream(bytes); TTransport trans = new TIOStreamTransport(in); TBinaryProtocol tp = new TBinaryProtocol(trans); User user = new User(); user.read(tp); } int size = bytes.length; long lastTime = System.currentTimeMillis() - start; System.out.println(&amp;quot;Thrift 反序列化循环100w times，单条大小：&amp;quot;+size+&amp;quot; byte&amp;quot;+&amp;quot; 耗时：&amp;quot;+lastTime+&amp;quot; ms&amp;quot;); } public void initBytes() throws TException { User user = new User(); user.setId(&amp;quot;123&amp;quot;); user.setAge(123); user.setDesc(&amp;quot;ni hao i am test&amp;quot;); user.setName(&amp;quot;test&amp;quot;); user.setTitle(&amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot;); user.setWeight(200); // 序列化 ByteArrayOutputStream out = new ByteArrayOutputStream(); TTransport trans = new TIOStreamTransport(out); TBinaryProtocol tp = new TBinaryProtocol(trans); user.write(tp); bytes = out.toByteArray(); } public static void main(String [] args) throws TException { ThriftSimlpleTest test = new ThriftSimlpleTest(); test.serialization(); test.un_serialization(); } } 3、protobuf 固定1分钟此测试代码（简单对象） package com.many.pro.thriftvsproto; import com.google.protobuf.InvalidProtocolBufferException; import com.many.pro.UserModel; import java.util.concurrent.*; public class PBSimpleOneMinutes { static int sum = 0; static final ExecutorService exec = Executors.newFixedThreadPool(1); private static byte [] bytes ; static class Service implements Runnable{ @Override public void run() { while (true){ serialization(); un_serialization(); sum++; } } } public static void un_serialization(){ // initBytes(); // long start = System.currentTimeMillis(); try { UserModel.User.parseFrom(bytes); } catch (InvalidProtocolBufferException e) { e.printStackTrace(); } //int size = bytes.length; // long lastTime = System.currentTimeMillis() - start; // System.out.println(&amp;quot;protobuffer 反序列化循环100w times，单条大小：&amp;quot;+size+&amp;quot; byte&amp;quot;+&amp;quot; 耗时：&amp;quot;+lastTime+&amp;quot; ms&amp;quot;); } public static void serialization(){ UserModel.User.Builder builder = UserModel.User.newBuilder(); builder.setId(&amp;quot;123&amp;quot;); builder.setAge(123); builder.setDesc(&amp;quot;ni hao i am test&amp;quot;); builder.setName(&amp;quot;test&amp;quot;); builder.setTitle(&amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot;); builder.setWeight(200); UserModel.User user = builder.build(); user.toByteArray(); } public static void initBytes(){ UserModel.User.Builder builder = UserModel.User.newBuilder(); builder.setId(&amp;quot;123&amp;quot;); builder.setAge(123); builder.setDesc(&amp;quot;ni hao i am test&amp;quot;); builder.setName(&amp;quot;test&amp;quot;); builder.setTitle(&amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot;); builder.setWeight(200); UserModel.User user = builder.build(); bytes = user.toByteArray(); } public static void main(String [] a){ initBytes(); Future future = exec.submit(new Service()); try { future.get(60, TimeUnit.SECONDS); } catch (InterruptedException e) { e.printStackTrace(); } catch (ExecutionException e) { e.printStackTrace(); } catch (TimeoutException e) { e.printStackTrace(); } System.out.println(&amp;quot;60 seconds run &amp;quot; + sum + &amp;quot; tiems&amp;quot;); } } 4、thrift 固定1分钟此测试代码（简单对象） package com.many.pro.thriftvsproto; import org.apache.thrift.TException; import java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import java.util.concurrent.*; import com.many.thrift.User; import org.apache.thrift.protocol.TBinaryProtocol; import org.apache.thrift.transport.TIOStreamTransport; import org.apache.thrift.transport.TTransport; public class ThriftSimpleOneMinutes { static int sum = 0; private static byte [] bytes; static final ExecutorService exec = Executors.newFixedThreadPool(1); static class Service implements Runnable{ @Override public void run() { while (true){ try { serialization(); un_serialization(); } catch (TException e) { e.printStackTrace(); } sum++; } } } public static void serialization() throws TException { User user = new User(); user.setId(&amp;quot;123&amp;quot;); user.setAge(123); user.setDesc(&amp;quot;ni hao i am test&amp;quot;); user.setName(&amp;quot;test&amp;quot;); user.setTitle(&amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot;); user.setWeight(200); // 序列化 ByteArrayOutputStream out = new ByteArrayOutputStream(); TTransport trans = new TIOStreamTransport(out); TBinaryProtocol tp = new TBinaryProtocol(trans); user.write(tp); } public static void un_serialization() throws TException { ByteArrayInputStream in = new ByteArrayInputStream(bytes); TTransport trans = new TIOStreamTransport(in); TBinaryProtocol tp = new TBinaryProtocol(trans); User user = new User(); user.read(tp); } public static void initBytes() throws TException { User user = new User(); user.setId(&amp;quot;123&amp;quot;); user.setAge(123); user.setDesc(&amp;quot;ni hao i am test&amp;quot;); user.setName(&amp;quot;test&amp;quot;); user.setTitle(&amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot; + &amp;quot;this is a test vs thrift serialization this is a test vs thrift serialization this is a test vs thrift serialization&amp;quot;); user.setWeight(200); // 序列化 ByteArrayOutputStream out = new ByteArrayOutputStream(); TTransport trans = new TIOStreamTransport(out); TBinaryProtocol tp = new TBinaryProtocol(trans); user.write(tp); bytes = out.toByteArray(); } public static void main(String [] a){ try { initBytes(); } catch (TException e) { e.printStackTrace(); } Future future = exec.submit(new Service()); try { future.get(60, TimeUnit.SECONDS); } catch (InterruptedException e) { e.printStackTrace(); } catch (ExecutionException e) { e.printStackTrace(); } catch (TimeoutException e) { e.printStackTrace(); } System.out.println(&amp;quot;60 seconds run &amp;quot; + sum + &amp;quot; tiems&amp;quot;); } } 复杂对象结构的对比 protobuf 文件 // See README.txt for information and build instructions.</description>
    </item>
    
    <item>
      <title>thrift 教程</title>
      <link>http://babifarm.com/post/2016/08/thrift/</link>
      <pubDate>Tue, 02 Aug 2016 09:06:46 -0700</pubDate>
      
      <guid>http://babifarm.com/post/2016/08/thrift/</guid>
      <description>thrift 安装 thrift 版本：0.9.0 thrift 依赖环境 A relatively POSIX-compliant *NIX system Cygwin or MinGW can be used on Windows g++ 3.3.5+ boost 1.33.1+ (1.34.0 for building all tests) Runtime libraries for lex and yacc might be needed for the compiler. 安装步骤 1、安装依赖 $ yum install automake libtool flex bison pkgconfig gcc-c++ boost-devel libevent-devel zlib-devel python-devel ruby-devel Loaded plugins: fastestmirror Loading mirror speeds from cached hostfile c6-media | 4.0 kB 00:00 Setting up Install Process Package automake-1.11.1-4.el6.noarch already installed and latest version Package 1:pkgconfig-0.23-9.1.el6.x86_64 already installed and latest version Package gcc-c++-4.4.7-3.el6.x86_64 already installed and latest version Package zlib-devel-1.2.3-29.el6.x86_64 already installed and latest version Resolving Dependencies --&amp;gt; Running transaction check ---&amp;gt; Package bison.x86_64 0:2.4.1-5.el6 will be installed ---&amp;gt; Package boost-devel.x86_64 0:1.41.0-11.el6_1.2 will be installed --&amp;gt; Processing Dependency: boost = 1.41.0-11.el6_1.2 for package: boost-devel-1.41.0-11.el6_1.2.x86_64 --&amp;gt; Processing Dependency: libboost_wserialization.so.5()(64bit) for package: boost-devel-1.41.0-11.el6_1.2.x86_64 --&amp;gt; Processing Dependency: libboost_wserialization-mt.so.5()(64bit) for package: boost-devel-1.41.0-11.el6_1.2.x86_64 ....................................</description>
    </item>
    
  </channel>
</rss>
